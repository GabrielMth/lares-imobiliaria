<div class="property-form">
  <h2 class="form-title">
    {{ property ? "‚úèÔ∏è Editar Im√≥vel" : "‚ûï Adicionar Novo Im√≥vel" }}
  </h2>

  <form (ngSubmit)="onSubmit()" #propertyForm="ngForm">
    <div class="form-grid">
      <!-- Tipo -->
      <div class="form-group">
        <label for="type">Tipo de Im√≥vel *</label>
        <select id="type" name="type" [(ngModel)]="formData.type" required>
          <option value="casa">üè† Casa</option>
          <option value="apartamento">üè¢ Apartamento</option>
          <option value="terreno">üå≥ Terreno</option>
          <option value="chacara">üåÑ Ch√°cara</option>
          <option value="barracao">üè≠ Barrac√£o</option>
          <option value="sitio">üåæ S√≠tio</option>
        </select>
      </div>

      <!-- Transa√ß√£o -->
      <div class="form-group">
        <label for="transactionType">Tipo de Transa√ß√£o *</label>
        <select
          id="transactionType"
          name="transactionType"
          [(ngModel)]="formData.transactionType"
          required
        >
          <option value="venda">üí∞ Venda</option>
          <option value="aluguel">üè∑Ô∏è Aluguel</option>
        </select>
      </div>

      <!-- T√≠tulo -->
      <div class="form-group full-width">
        <label for="title">T√≠tulo do Im√≥vel *</label>
        <input
          type="text"
          id="title"
          name="title"
          [(ngModel)]="formData.title"
          placeholder="Ex: Casa Moderna com Piscina"
          required
        />
      </div>

      <!-- Pre√ßo -->
      <div class="form-group">
        <label for="price">Pre√ßo (R$) *</label>
        <input
          type="number"
          id="price"
          name="price"
          [(ngModel)]="formData.price"
          placeholder="850000"
          min="0"
          required
        />
      </div>

      <!-- √Årea -->
      <div class="form-group">
        <label for="area">√Årea (m¬≤) *</label>
        <input
          type="number"
          id="area"
          name="area"
          [(ngModel)]="formData.area"
          placeholder="280"
          min="0"
          required
        />
      </div>

      <!-- Quartos -->
      <div class="form-group">
        <label for="bedrooms">Quartos</label>
        <input
          type="number"
          id="bedrooms"
          name="bedrooms"
          [(ngModel)]="formData.bedrooms"
          placeholder="4"
          min="0"
        />
      </div>

      <!-- Banheiros -->
      <div class="form-group">
        <label for="bathrooms">Banheiros</label>
        <input
          type="number"
          id="bathrooms"
          name="bathrooms"
          [(ngModel)]="formData.bathrooms"
          placeholder="3"
          min="0"
        />
      </div>

      <!-- Vagas -->
      <div class="form-group">
        <label for="parking">Vagas de Garagem</label>
        <input
          type="number"
          id="parking"
          name="parking"
          [(ngModel)]="formData.parking"
          placeholder="2"
          min="0"
        />
      </div>

      <!-- CEP -->
      <div class="form-group">
        <label for="cep">CEP *</label>
        <input
          type="text"
          id="cep"
          name="cep"
          [(ngModel)]="formData.cep"
          placeholder="00000-000"
          required
          inputmode="numeric"
          maxlength="9"
          (input)="onCepInput()"
          (blur)="buscarCepSeCompleto()"
        />
      </div>

      <!-- Logradouro -->
      <div class="form-group full-width">
        <label for="logradouro">Logradouro *</label>
        <input
          type="text"
          id="logradouro"
          name="logradouro"
          [(ngModel)]="formData.logradouro"
          placeholder="Rua, Avenida, Travessa..."
          required
        />
      </div>

      <!-- N√∫mero -->
      <div class="form-group">
        <label for="numero">N√∫mero *</label>
        <input
          type="text"
          id="numero"
          name="numero"
          [(ngModel)]="formData.numero"
          placeholder="123"
          required
        />
      </div>

      <!-- Bairro -->
      <div class="form-group">
        <label for="bairro">Bairro *</label>
        <input
          type="text"
          id="bairro"
          name="bairro"
          [(ngModel)]="formData.bairro"
          placeholder="Centro"
          required
        />
      </div>

      <!-- Cidade -->
      <div class="form-group">
        <label for="cidade">Cidade *</label>
        <input
          type="text"
          id="cidade"
          name="cidade"
          [(ngModel)]="formData.cidade"
          placeholder="S√£o Paulo"
          required
        />
      </div>

      <!-- Estado -->
      <div class="form-group">
        <label for="estado">Estado *</label>
        <input
          type="text"
          id="estado"
          name="estado"
          [(ngModel)]="formData.estado"
          placeholder="SP"
          maxlength="2"
          required
        />
      </div>

      <!-- Descri√ß√£o -->
      <div class="form-group full-width">
        <label for="description">Descri√ß√£o *</label>
        <textarea
          id="description"
          name="description"
          [(ngModel)]="formData.description"
          rows="4"
          placeholder="Descreva as caracter√≠sticas principais do im√≥vel..."
          required
        ></textarea>
      </div>

      <!-- Fotos -->
      <div class="form-group full-width">
        <label for="fotos">üì∏ Fotos do im√≥vel</label>

        <input
          type="file"
          id="fotos"
          name="fotos"
          accept="image/*"
          multiple
          (change)="onFilesSelected($event)"
        />

        <small>
          Selecione at√© {{ maxFotos }} imagens (JPG/PNG/WebP). Tamanho m√°x:
          {{ maxSizeMb }}MB cada.
        </small>

        <div class="upload-meta" *ngIf="selectedFiles.length > 0">
          <span
            ><b>{{ selectedFiles.length }}</b> selecionada(s)</span
          >
          <button type="button" class="btn-link" (click)="clearPhotos()">
            Limpar tudo
          </button>
        </div>

        <!-- Preview grid -->
        <div class="preview-grid" *ngIf="previewUrls.length > 0">
          <div
            class="preview-card"
            *ngFor="let url of previewUrls; let i = index"
          >
            <div class="preview-image">
              <img [src]="url" [alt]="'Foto ' + (i + 1)" />

              <div class="badge" *ngIf="i === mainPhotoIndex">Principal</div>

              <div class="actions">
                <button
                  type="button"
                  class="action-btn"
                  (click)="setMainPhoto(i)"
                  title="Definir como principal"
                >
                  ‚≠ê
                </button>
                <button
                  type="button"
                  class="action-btn danger"
                  (click)="removePhoto(i)"
                  title="Remover foto"
                >
                  ‚úñ
                </button>
              </div>
            </div>

            <div class="preview-info">
              <div class="name">{{ selectedFiles[i]?.name }}</div>
              <div class="size">
                {{ formatFileSize(selectedFiles[i]?.size || 0) }}
              </div>
            </div>
          </div>
        </div>

        <div class="error-box" *ngIf="photoError">
          {{ photoError }}
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-outline" (click)="cancel()">
        Cancelar
      </button>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!propertyForm.form.valid"
      >
        {{ property ? "üíæ Salvar Altera√ß√µes" : "‚ûï Adicionar Im√≥vel" }}
      </button>
    </div>
  </form>
</div>
