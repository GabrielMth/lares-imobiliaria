<div class="property-card" *ngIf="property" [class.lightbox-active]="showLightbox">
  <div class="property-images">
    <div class="main-image-container" *ngIf="property.urlsFotos && property.urlsFotos.length > 0">
      <img [src]="'http://localhost:8080/uploads/' + property.urlsFotos[currentImageIndex]" [alt]="property.titulo"
        class="main-image" (click)="openLightbox(currentImageIndex)">

      <button class="nav-button prev" (click)="prevImage(); $event.stopPropagation()" *ngIf="property.urlsFotos.length > 1">â€¹</button>
      <button class="nav-button next" (click)="nextImage(); $event.stopPropagation()" *ngIf="property.urlsFotos.length > 1">â€º</button>

      <div class="image-indicators" *ngIf="property.urlsFotos.length > 1">
        <span *ngFor="let img of property.urlsFotos; let i = index" class="indicator"
          [class.active]="i === currentImageIndex" (click)="setImage(i); $event.stopPropagation()">
        </span>
      </div>

      <span class="property-badge">{{ property.tipoImovel | titlecase }}</span>

      <span class="transaction-badge" [class.venda]="property.status === 'VENDA'"
        [class.aluguel]="property.status === 'ALUGUEL'">
        {{ property.status | titlecase }}
      </span>

      <span class="featured-badge" *ngIf="property.featured">Destaque</span>
    </div>

    <div class="thumbnail-container" *ngIf="property.urlsFotos && property.urlsFotos.length > 1">
      <img *ngFor="let img of property.urlsFotos.slice(0, 4); let i = index"
        [src]="'http://localhost:8080/uploads/' + img" [alt]="property.titulo + ' - ' + (i + 1)" class="thumbnail"
        [class.active]="i === currentImageIndex" (click)="setImage(i)">
    </div>
  </div>

  <div class="property-content">
    <h3 class="property-title">{{ property.titulo }}</h3>

    <p class="property-location" *ngIf="property.endereco">
      ğŸ“ {{ property.endereco.logradouro }}, {{ property.endereco.numero }} - {{ property.endereco.bairro }}, {{
      property.endereco.cidade }}
    </p>

    <p class="property-location" *ngIf="!property.endereco">
      ğŸ“ LocalizaÃ§Ã£o sob consulta
    </p>
    <p class="property-price">{{ formatPrice(property.valor) }}</p>

    <div class="property-features">
      <span class="feature" *ngIf="property.quartos">
        ğŸ›ï¸ {{ property.quartos }} {{ property.quartos === 1 ? 'Quarto' : 'Quartos' }}
      </span>
      <span class="feature" *ngIf="property.banheiros">
        ğŸš¿ {{ property.banheiros }} {{ property.banheiros === 1 ? 'Banheiro' : 'Banheiros' }}
      </span>
      <span class="feature" *ngIf="property.vagasGaragem">
        ğŸš— {{ property.vagasGaragem }} {{ property.vagasGaragem === 1 ? 'Vaga' : 'Vagas' }}
      </span>
      <span class="feature">
        ğŸ“ {{ property.areaTotal }}mÂ²
      </span>
    </div>

    <p class="property-description">{{ property.descricao }}</p>

    <button class="btn btn-whatsapp w-full" (click)="sendWhatsApp()">
      ğŸ“± Mostrar Interesse
    </button>
  </div>
</div>

<!-- Lightbox movido para FORA do card para evitar conflitos de hover -->
<div class="lightbox-overlay" *ngIf="showLightbox && property" (click)="closeLightbox()">
  <div class="lightbox-content" (click)="$event.stopPropagation()">
    <button class="lightbox-close" (click)="closeLightbox()">âœ•</button>

    <button class="lightbox-nav prev" (click)="prevLightboxImage(); $event.stopPropagation()"
      *ngIf="property.urlsFotos && property.urlsFotos.length > 1">â€¹</button>

    <div class="lightbox-image-container" *ngIf="property.urlsFotos">
      <img [src]="'http://localhost:8080/uploads/' + property.urlsFotos[lightboxImageIndex]"
        alt="{{ property.titulo }}" class="lightbox-image" (click)="$event.stopPropagation()">

      <div class="lightbox-info" (click)="$event.stopPropagation()">
        <h4>{{ property.titulo }}</h4>
        <p>{{ lightboxImageIndex + 1 }} / {{ property.urlsFotos.length }}</p>
      </div>
    </div>

    <button class="lightbox-nav next" (click)="nextLightboxImage(); $event.stopPropagation()"
      *ngIf="property.urlsFotos && property.urlsFotos.length > 1">â€º</button>

    <div class="lightbox-thumbnails" *ngIf="property.urlsFotos">
      <img *ngFor="let img of property.urlsFotos; let i = index; trackBy: trackByIndex" [src]="'http://localhost:8080/uploads/' + img"
        [alt]="property.titulo + ' - ' + (i + 1)" class="lightbox-thumbnail" [class.active]="i === lightboxImageIndex"
        (click)="setLightboxImage(i); $event.stopPropagation()">
    </div>
  </div>
</div>